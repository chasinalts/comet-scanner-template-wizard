var z=Object.defineProperty;var C=(e,t,o)=>t in e?z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var I=(e,t,o)=>C(e,typeof t!="symbol"?t+"":t,o);import{a as g}from"./vendor-react-V1NwqAnN.js";import{r as F,s as E,f as L,h as N,i as j}from"./index-DVQGbPOG.js";import{j as h,m as M}from"./vendor-ui-CMso90iE.js";class ${constructor(t=100){I(this,"cache");I(this,"maxSize");this.cache=new Map,this.maxSize=t}get(t){const o=this.cache.get(t);if(o){if(o.expiry&&Date.now()>o.expiry){this.cache.delete(t);return}return this.cache.delete(t),this.cache.set(t,o),o.value}}set(t,o,n=null){if(this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;s&&this.cache.delete(s)}const a=n?Date.now()+n:null;this.cache.set(t,{value:o,expiry:a})}clear(){this.cache.clear()}}function y(e,t={}){const{maxCacheSize:o=100,ttl:n=null}=t,a=new $(o),s=(...r)=>{const i=JSON.stringify(r),l=a.get(i);if(l!==void 0)return l;const u=e(...r);return u instanceof Promise?(a.set(i,u,n),u.then(m=>(a.set(i,m,n),m)).catch(m=>{throw a.get(i)===u&&a.set(i,void 0,0),m})):(a.set(i,u,n),u)};return s.clearCache=()=>{a.clear()},s}const X=()=>{const[e,t]=g.useState([]);g.useEffect(()=>{const d=()=>{const w=localStorage.getItem("admin_contents");w&&t(JSON.parse(w))};d();const c=w=>{w.key==="admin_contents"&&d()};return window.addEventListener("storage",c),()=>window.removeEventListener("storage",c)},[]);const o=g.useMemo(()=>y(d=>d.filter(c=>c.type==="banner")),[]),n=g.useCallback(()=>{const d=o(e);if(d.length===0)return null;const c=d[d.length-1];return{id:c.id,src:c.imageUrl||"",alt:c.title,scale:c.scale,displayText:c.displayText}},[e,o]),a=g.useMemo(()=>y(d=>d.filter(c=>c.type==="scanner")),[]),s=g.useMemo(()=>y(d=>[...d].sort((c,w)=>w.updatedAt-c.updatedAt)),[]),r=g.useMemo(()=>y(d=>d.map(c=>({id:c.id,src:c.imageUrl||"",alt:c.title,scale:c.scale,displayText:c.displayText}))),[]),i=g.useCallback(()=>{const d=a(e),c=s(d);return r(c)},[e,a,s,r]),l=g.useMemo(()=>y(d=>d.filter(c=>c.type==="template")),[]),u=g.useMemo(()=>y(d=>d.map(c=>({id:c.id,title:c.title,code:c.content}))),[]),m=g.useCallback(()=>{const d=l(e),c=s(d);return u(c)},[e,l,s,u]),p=g.useMemo(()=>y(d=>d.filter(c=>c.type==="question")),[]),x=g.useMemo(()=>y(d=>d.map(c=>({id:c.id,title:c.title,text:c.content}))),[]),b=g.useCallback(()=>{const d=p(e),c=s(d);return x(c)},[e,p,s,x]);return g.useMemo(()=>({getBannerImage:n,getScannerImages:i,getTemplates:m,getQuestions:b,hasContent:e.length>0}),[n,i,m,b,e.length])},f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));function k(e,t=0){return(f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]).toLowerCase()}let R;const O=new Uint8Array(16);function T(){if(!R){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");R=crypto.getRandomValues.bind(crypto)}return R(O)}const D=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),v={randomUUID:D};function Q(e,t,o){if(v.randomUUID&&!e)return v.randomUUID();e=e||{};const n=e.random??e.rng?.()??T();if(n.length<16)throw new Error("Random bytes length must be >= 16");return n[6]=n[6]&15|64,n[8]=n[8]&63|128,k(n)}const B=async(e,t,o="public, max-age=31536000")=>{try{const n=e.name.split(".").pop(),a=`${Q()}.${n}`,s=`${t}/${a}`,r=F(E,s),i={contentType:e.type,cacheControl:o,customMetadata:{originalName:e.name,uploadedAt:new Date().toISOString()}},l=N(r,e,i);return new Promise((u,m)=>{l.on("state_changed",p=>{const x=p.bytesTransferred/p.totalBytes*100;console.log(`Upload progress: ${x.toFixed(2)}%`)},p=>{console.error("Error uploading file to Firebase Storage:",p),m(p)},async()=>{try{const p=await j(l.snapshot.ref);console.log("File uploaded successfully:",l.snapshot.metadata.fullPath),u(p)}catch(p){console.error("Error getting download URL:",p),m(p)}})})}catch(n){throw console.error("Error setting up file upload to Firebase Storage:",n),n}},P=async e=>{try{const t=decodeURIComponent(e),o=t.indexOf("/o/")+3,n=t.indexOf("?");if(o===-1||n===-1){console.error("Invalid Firebase Storage URL format:",e);return}const a=t.substring(o,n),s=F(E,a);await L(s),console.log("File deleted successfully:",a)}catch(t){throw console.error("Error deleting file from Firebase Storage:",t),t}},A=async(e,t=1920,o=1080,n=.8)=>new Promise((a,s)=>{try{const r=new FileReader;r.onload=i=>{const l=new Image;l.onload=()=>{let u=l.width,m=l.height;if(u>t||m>o){const b=Math.min(t/u,o/m);u=Math.floor(u*b),m=Math.floor(m*b)}const p=document.createElement("canvas");p.width=u,p.height=m;const x=p.getContext("2d");if(!x){s(new Error("Could not get canvas context"));return}x.drawImage(l,0,0,u,m),p.toBlob(b=>{if(!b){s(new Error("Could not create blob from canvas"));return}const S=new File([b],e.name,{type:e.type,lastModified:Date.now()});console.log("Image compression results:",{originalSize:e.size,compressedSize:S.size,compressionRatio:(S.size/e.size*100).toFixed(2)+"%",dimensions:`${u}x${m}`}),a(S)},e.type,n)},l.onerror=()=>{s(new Error("Failed to load image for compression"))},typeof i.target?.result=="string"?l.src=i.target.result:s(new Error("Failed to read file"))},r.onerror=()=>{s(new Error("Failed to read file"))},r.readAsDataURL(e)}catch(r){s(r)}}),_=(e,t=1)=>{const o=t*1024*1024;return e.size>o},q=async(e,t={maxWidth:1920,maxHeight:1080,quality:.8,maxSizeInMB:1})=>_(e,t.maxSizeInMB)?(console.log("Image is large, applying compression..."),A(e,t.maxWidth,t.maxHeight,t.quality)):(console.log("Image is already optimized, skipping compression"),e),Y=(e,t)=>{const o=URL.createObjectURL(e),n=new FileReader;n.onloadend=()=>{const a=n.result;console.log("Image uploaded locally:",{file:e,imageUrl:a.substring(0,50)+"...",imagePreview:o}),t(a,o)},n.readAsDataURL(e)},Z=async(e,t,o)=>{try{const n=URL.createObjectURL(e),a=await q(e,{maxWidth:1920,maxHeight:1080,quality:.85,maxSizeInMB:1}),s=`images/${t}`,r=await B(a,s);console.log("Image uploaded to Firebase:",{originalSize:e.size,processedSize:a.size,compressionRatio:(a.size/e.size*100).toFixed(2)+"%",imageUrl:r}),o(r,n),URL.revokeObjectURL(n)}catch(n){throw console.error("Error in handleFirebaseImageUpload:",n),n}},J=async(e,t=!1)=>{if(e.startsWith("blob:"))URL.revokeObjectURL(e);else if(t&&e.includes("firebasestorage.googleapis.com"))try{await P(e)}catch(o){console.error("Error deleting file from Firebase Storage:",o)}},W=(e,t,o)=>new Promise((n,a)=>{const s=new Image;s.src=URL.createObjectURL(e),s.onload=()=>{let r=s.width,i=s.height;r>t&&(i=i*t/r,r=t),i>o&&(r=r*o/i,i=o);const l=document.createElement("canvas");l.width=r,l.height=i;const u=l.getContext("2d");if(!u){a(new Error("Could not get canvas context"));return}u.drawImage(s,0,0,r,i),l.toBlob(m=>{m?n(m):a(new Error("Could not create blob from canvas"))},e.type),URL.revokeObjectURL(s.src)},s.onerror=()=>{a(new Error("Failed to load image")),URL.revokeObjectURL(s.src)}}),ee=()=>{const[e,t]=g.useState(()=>{const s=localStorage.getItem("admin_questions");return s?JSON.parse(s):[]});return g.useEffect(()=>{localStorage.setItem("admin_questions",JSON.stringify(e))},[e]),g.useEffect(()=>()=>{e.forEach(s=>{s.options?.forEach(r=>{r.imagePreview&&J(r.imagePreview)})})},[e]),{questions:e,setQuestions:t,addQuestion:s=>{const r={id:`question-${Date.now()}`,type:s,text:"",required:!1,...s==="choice"&&{options:[]},...s==="text"&&{placeholderVariable:""}};t(i=>[...i,r])},updateQuestion:(s,r)=>{t(i=>i.map(l=>l.id===s?{...l,...r}:l))},deleteQuestion:s=>{t(r=>r.filter(i=>i.id!==s))}}},te=()=>{const[e,t]=g.useState(()=>{const r=localStorage.getItem("admin_sections");return r?JSON.parse(r):[]});return g.useEffect(()=>{localStorage.setItem("admin_sections",JSON.stringify(e))},[e]),{sections:e,setSections:t,addSection:()=>{const r={id:`section-${Date.now()}`,title:"New Section",code:"",isMandatory:!1};t(i=>[...i,r])},updateSection:(r,i)=>{t(l=>l.map(u=>u.id===r?{...u,...i}:u))},deleteSection:r=>{t(i=>i.filter(l=>l.id!==r))},reorderSections:r=>{t(r)}}},U=({label:e,error:t,helperText:o,required:n,children:a,fullWidth:s=!1})=>h.jsxs("div",{className:`${s?"w-full":""} space-y-1`,children:[e&&h.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e,n&&h.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),h.jsx("div",{className:"mt-1",children:a}),(t||o)&&h.jsx("div",{className:"mt-1",children:t?h.jsx(M.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-sm text-red-600",children:t}):o?h.jsx("p",{className:"text-sm text-gray-500",children:o}):null})]}),se=({label:e,error:t,helperText:o,required:n,fullWidth:a,...s})=>h.jsx(U,{label:e,error:t,helperText:o,required:n,fullWidth:a,children:h.jsx("input",{className:`
          block rounded-md shadow-sm
          ${a?"w-full":"w-auto"}
          ${t?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...s})}),oe=({label:e,error:t,helperText:o,required:n,fullWidth:a,...s})=>h.jsx(U,{label:e,error:t,helperText:o,required:n,fullWidth:a,children:h.jsx("textarea",{className:`
          block rounded-md shadow-sm
          ${a?"w-full":"w-auto"}
          ${t?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...s})}),ne=({label:e,error:t,helperText:o,required:n,fullWidth:a,children:s,...r})=>h.jsx(U,{label:e,error:t,helperText:o,required:n,fullWidth:a,children:h.jsx("select",{className:`
          block rounded-md shadow-sm
          ${a?"w-full":"w-auto"}
          ${t?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...r,children:s})}),re=({label:e,error:t,helperText:o,required:n,...a})=>h.jsx(U,{error:t,helperText:o,required:n,children:h.jsxs("div",{className:"flex items-center",children:[h.jsx("input",{type:"checkbox",className:`
            rounded border-gray-300 text-blue-600 shadow-sm
            focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 focus:ring-opacity-50
            ${t?"border-red-500":""}
          `,...a}),e&&h.jsxs("label",{className:"ml-2 block text-sm text-gray-900",children:[e,n&&h.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})]})});export{re as C,ne as S,se as T,ee as a,te as b,J as c,oe as d,Y as e,Z as h,y as m,W as r,X as u};
