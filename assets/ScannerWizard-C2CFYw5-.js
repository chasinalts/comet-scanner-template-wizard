import{j as e,A as M,m as I}from"./vendor-ui-B2A3YeRo.js";import{a as l}from"./vendor-react-CTBdW232.js";import{r as P,m as E,u as z,a as L,b as O,C as A,T as U}from"./FormField-CCsVGX-C.js";import{a as $,u as B,b as R,T as W}from"./index-ukGo-UzT.js";const F={hidden:{opacity:0},visible:{opacity:1}},Q={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},_=({isOpen:o,onClose:h,title:b,children:y,footer:x,size:p="md",showCloseButton:f=!0})=>{const v={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[p];return e.jsx(M,{mode:"wait",children:o&&e.jsxs(l.Fragment,{children:[e.jsx(I.div,{variants:F,initial:"hidden",animate:"visible",exit:"hidden",onClick:h,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(I.div,{variants:Q,initial:"hidden",animate:"visible",exit:"exit",className:`${v} w-full bg-white rounded-lg shadow-xl`,onClick:j=>j.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:b}),f&&e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:y}),x&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:x})]})})]})})},D=({src:o,alt:h,className:b="",width:y,height:x,sizes:p="100vw",style:f={},onClick:v,loading:j="lazy",decoding:C="async",gallerySize:k=!1})=>{const[n,s]=l.useState(null),[i,a]=l.useState(!1);l.useEffect(()=>{let w=!0,c=null;return(async()=>{if(a(!1),s(null),k)try{const m=await(await fetch(o)).blob(),S=await P(m,400,400);w&&(c=URL.createObjectURL(S),s(c),a(!0))}catch(d){console.error(`Failed to load or resize image: ${o}`,d)}else{const d=new Image;d.src=o,d.onload=()=>{w&&(s(o),a(!0))},d.onerror=()=>{console.error(`Failed to load image: ${o}`)}}})(),()=>{w=!1,c&&URL.revokeObjectURL(c)}},[o,k]);const N=()=>{if(!o.startsWith("data:")&&!o.startsWith("blob:"))return`${o} 1x, ${o} 2x`};return n!==null&&(!k||k&&i)?e.jsx("img",{src:n,alt:h,className:`transition-opacity duration-300 ${i?"opacity-100":"opacity-0"} ${b}`,style:{...f,objectFit:"contain"},width:y,height:x,loading:j,decoding:C,sizes:p,srcSet:N(),onClick:v,onLoad:()=>a(!0)}):null},V=()=>{const{state:o}=$(),{answers:h,sections:b,questions:y}=o,x=l.useMemo(()=>E(n=>n.filter(s=>s.isMandatory)),[]),p=l.useMemo(()=>E((n,s)=>n.find(i=>i.id===s)),[]),f=l.useMemo(()=>E((n,s)=>n.find(i=>i.id===s)),[]),v=l.useCallback((n,s,i)=>{const a=new RegExp(`{{\\s*${s}\\s*}}`,"g");return n.replace(a,i)},[]),j=l.useCallback(n=>{let s="";const i=new Set;return n.forEach(a=>{s+=`// --- Section: ${a.title} (Mandatory) ---
`,s+=a.code+`

`,i.add(a.id)}),{code:s,includedIds:i}},[]),C=l.useCallback((n,s,i,a)=>{let N="";return Object.entries(n).forEach(([w,c])=>{const r=p(s,w);if(!r)return;let d;if(r.type==="choice"&&c?(Array.isArray(c)?c:[c]).forEach(S=>{const t=r.options?.find(u=>u.value===S);t?.linkedSectionId&&(d=t.linkedSectionId)}):(r.type==="text"||r.type==="boolean")&&r.linkedSectionId&&(d=r.linkedSectionId),d&&!a.has(d)){const m=f(i,d);if(m){let S=m.code;r.type==="text"&&r.placeholderVariable&&typeof c=="string"&&(S=v(S,r.placeholderVariable,c)),N+=`// --- Section: ${m.title} (Linked by: ${r.text.substring(0,20)}...) ---
`,N+=S+`

`,a.add(m.id)}}else r.type==="text"&&r.placeholderVariable&&typeof c=="string"&&!d&&(N+=`// User input for "${r.text.substring(0,20)}...": ${c}

`)}),N},[p,f,v]),k=l.useMemo(()=>{const n=x(b),{code:s,includedIds:i}=j(n),a=C(h,y,b,i);return(s+a).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[h,b,y,x,j,C]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:k})})]})},Y={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},T={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},X=()=>{const{getBannerImage:o,getScannerImages:h}=z();B();const{theme:b}=R(),{state:y,dispatch:x}=$(),{questions:p}=L(),{sections:f}=O(),[v,j]=l.useState(null),[C,k]=l.useState("");l.useEffect(()=>{x({type:"SET_QUESTIONS",payload:p})},[p,x]),l.useEffect(()=>{x({type:"SET_SECTIONS",payload:f})},[f,x]);const n=o(),[s,i]=l.useState([]),[a,N]=l.useState(1),w=6;l.useEffect(()=>{try{const t=h();i(t),console.log("Scanner Images loaded:",t.length)}catch(t){console.error("Error loading scanner images:",t),i([])}},[h]);const c=()=>{const t=(a-1)*w;return s.slice(t,t+w)},r=Math.ceil(s.length/w),d=t=>{N(t)},m=(t,u)=>{x({type:"SET_ANSWER",payload:{questionId:t,value:u}})},S=t=>{const u=y.answers[t.id];switch(t.type){case"text":return e.jsx(U,{label:t.text,value:u||"",onChange:g=>m(t.id,g.target.value),required:t.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[t.text," ",t.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:t.options?.map(g=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer
                    transition-all duration-150 ease-in-out
                    ${u===g.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:t.id,value:g.value,checked:u===g.value,onChange:()=>m(t.id,g.value),className:"sr-only"}),g.imageUrl&&e.jsx("img",{src:g.imagePreview||g.imageUrl,alt:g.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${g.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:g.text})]},g.id))})]});case"boolean":return e.jsx(A,{label:t.text,checked:!!u,onChange:g=>m(t.id,g.target.checked),required:t.required});default:return null}};return e.jsx("div",{className:b==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200",children:[e.jsx(W,{}),e.jsxs(I.div,{variants:Y,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(I.div,{variants:T,className:"py-12 px-4 text-center",children:e.jsx("h1",{className:"text-5xl md:text-6xl lg:text-7xl font-bold text-gray-900 dark:text-white font-display tracking-tight",children:"COMET Scanner Template Wizard"})}),e.jsx(I.div,{variants:T,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800",children:n?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("img",{src:n.src,alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transform:`scale(${n.scale||1})`,transformOrigin:"center center"}})})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl text-white font-semibold",children:"Visualize Your Data with COMET Scanner"})})})}),s.length>0&&e.jsxs(I.div,{variants:T,className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-8 text-center",children:"Scanner Variations"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8",children:c().map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden cursor-pointer transform transition-transform hover:scale-105",onClick:()=>{j(t.src),k(t.displayText||"Scanner Variation")},children:[e.jsx("div",{className:"aspect-video bg-gray-100 dark:bg-gray-700 relative overflow-hidden",children:e.jsx(D,{src:t.src,alt:t.alt,className:"w-full h-full object-contain",style:{transform:`scale(${t.scale||1})`},gallerySize:!0})}),t.displayText&&e.jsx("div",{className:"p-4",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:t.displayText})})]},t.id))}),r>1&&e.jsx("div",{className:"flex justify-center mt-8",children:e.jsxs("nav",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>d(Math.max(1,a-1)),disabled:a===1,className:`px-3 py-1 rounded ${a===1?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700 dark:text-gray-500":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:"Previous"}),Array.from({length:r},(t,u)=>u+1).map(t=>e.jsx("button",{onClick:()=>d(t),className:`w-8 h-8 rounded flex items-center justify-center ${t===a?"bg-blue-600 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:t},t)),e.jsx("button",{onClick:()=>d(Math.min(r,a+1)),disabled:a===r,className:`px-3 py-1 rounded ${a===r?"bg-gray-100 text-gray-400 cursor-not-allowed dark:bg-gray-700 dark:text-gray-500":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600"}`,children:"Next"})]})})]}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(I.div,{variants:T,children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-6",children:"Configure Your Template"}),e.jsxs("div",{className:"space-y-6",children:[y.questions.map(t=>e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:S(t)},t.id)),y.questions.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No questions configured yet. Please set them up in the Admin Dashboard."})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(V,{})})]})]}),v&&e.jsx(_,{isOpen:!0,onClose:()=>{j(null),k("")},title:C,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx("img",{src:v,alt:C,className:"max-w-full max-h-[80vh] object-contain"})})})})]})})};export{X as default};
