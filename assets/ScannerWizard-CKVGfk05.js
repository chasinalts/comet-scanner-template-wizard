import{j as e,A as B,m as S}from"./vendor-ui-TSunr9ex.js";import{a as n}from"./vendor-react-Cdk6Nlqr.js";import{m as M,r as P,u as F,a as H,b as Q,C as D,T as _}from"./FormField-BGmfxGOJ.js";import{a as U,g as O,u as Y,b as G,T as J}from"./index-BECJhoTz.js";import{H as E}from"./HolographicText-B9MNqcop.js";const K={hidden:{opacity:0},visible:{opacity:1}},X={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},Z=({isOpen:s,onClose:u,title:y,children:m,footer:l,size:x="md",showCloseButton:f=!0})=>{const h={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[x];return e.jsx(B,{mode:"wait",children:s&&e.jsxs(n.Fragment,{children:[e.jsx(S.div,{variants:K,initial:"hidden",animate:"visible",exit:"hidden",onClick:u,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(S.div,{variants:X,initial:"hidden",animate:"visible",exit:"exit",className:`${h} w-full bg-white rounded-lg shadow-xl`,onClick:g=>g.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:y}),f&&e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:m}),l&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:l})]})})]})})},q=()=>{const{state:s}=U(),{answers:u,sections:y,questions:m}=s,l=n.useMemo(()=>M(i=>i.filter(a=>a.isMandatory)),[]),x=n.useMemo(()=>M((i,a)=>i.find(c=>c.id===a)),[]),f=n.useMemo(()=>M((i,a)=>i.find(c=>c.id===a)),[]),h=n.useCallback((i,a,c)=>{const o=new RegExp(`{{\\s*${a}\\s*}}`,"g");return i.replace(o,c)},[]),g=n.useCallback(i=>{let a="";const c=new Set;return i.forEach(o=>{a+=`// --- Section: ${o.title} (Mandatory) ---
`,a+=o.code+`

`,c.add(o.id)}),{code:a,includedIds:c}},[]),p=n.useCallback((i,a,c,o)=>{let v="";return Object.entries(i).forEach(([r,d])=>{const t=x(a,r);if(!t)return;let b;if(t.type==="choice"&&d?(Array.isArray(d)?d:[d]).forEach(N=>{const C=t.options?.find(L=>L.value===N);C?.linkedSectionId&&(b=C.linkedSectionId)}):(t.type==="text"||t.type==="boolean")&&t.linkedSectionId&&(b=t.linkedSectionId),b&&!o.has(b)){const j=f(c,b);if(j){let N=j.code;t.type==="text"&&t.placeholderVariable&&typeof d=="string"&&(N=h(N,t.placeholderVariable,d)),v+=`// --- Section: ${j.title} (Linked by: ${t.text.substring(0,20)}...) ---
`,v+=N+`

`,o.add(j.id)}}else t.type==="text"&&t.placeholderVariable&&typeof d=="string"&&!b&&(v+=`// User input for "${t.text.substring(0,20)}...": ${d}

`)}),v},[x,f,h]),w=n.useMemo(()=>{const i=l(y),{code:a,includedIds:c}=g(i),o=p(u,m,y,c);return(a+o).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[u,y,m,l,g,p]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:w})})]})},ee=(s={})=>{const[u,y]=n.useState(!1),m=n.useRef(null),{rootMargin:l="200px",threshold:x=0,triggerOnce:f=!0}=s;return n.useEffect(()=>{if(!m.current||u&&f)return;const h=m.current,g=new IntersectionObserver(p=>{const[w]=p;w.isIntersecting?(y(!0),f&&g.unobserve(h)):f||y(!1)},{rootMargin:l,threshold:x});return g.observe(h),()=>{g.unobserve(h),g.disconnect()}},[l,x,f,u]),{ref:m,isVisible:u}},$=({src:s,alt:u,className:y="",width:m,height:l,placeholderColor:x="#f3f4f6",style:f={},onClick:h,gallerySize:g=!1,sizes:p="100vw",loadingStrategy:w="lazy"})=>{const[i,a]=n.useState(null),[c,o]=n.useState(!1),[v,r]=n.useState(!1),{ref:d,isVisible:t}=ee({rootMargin:w==="eager"?"400px":"200px",threshold:0,triggerOnce:!0}),b=s.includes("firebasestorage.googleapis.com"),j=s.includes("supabase.co/storage");n.useEffect(()=>{if(!t)return;let k=!0,T=null;const A=setTimeout(()=>{k&&!i&&!v&&console.log("Image loading taking longer than expected:",s)},3e3);return(async()=>{try{if(b&&!g){a(s),o(!0);return}if(j){const I=O(s);if(a(I),!g){o(!0);return}}if(g)try{const W=await(await fetch(s)).blob(),V=await P(W,400,400);k&&(T=URL.createObjectURL(V),a(T))}catch(I){console.warn(`Failed to resize image, using original: ${s}`,I),k&&a(s)}else a(s)}catch(I){console.error(`Failed to load image: ${s}`,I),k&&(r(!0),b&&(a(s),o(!0)))}})(),()=>{k=!1,clearTimeout(A),T&&URL.revokeObjectURL(T)}},[t,s,g,b,j]);const N=()=>{o(!0)},C=()=>{r(!0),console.error(`Error loading image: ${s}`)},L=()=>{if(!s.startsWith("data:")&&!s.startsWith("blob:")){const k=j?O(s):s;return`${k} 1x, ${k} 2x`}},R=m&&l?l/m*100:0;return e.jsxs("div",{ref:d,className:`relative overflow-hidden ${y}`,style:{backgroundColor:x,paddingBottom:R?`${R}%`:void 0,...f},onClick:h,children:[i&&e.jsx("img",{src:i,alt:u,className:`transition-opacity duration-300 ${c?"opacity-100":"opacity-0"} absolute inset-0 w-full h-full object-contain`,onLoad:N,onError:C,width:m,height:l,sizes:p,srcSet:L()}),(!i||!c)&&!v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-red-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})})]})},te=({images:s,onImageClick:u,className:y="",itemClassName:m="",columnCount:l=3,itemGap:x=16,loadingStrategy:f="lazy"})=>{const[h,g]=n.useState(0),[p,w]=n.useState(20),i=n.useRef(null),a=n.useRef(null),c=n.useRef(null),o=n.useCallback(()=>{if(!i.current)return 20;const t=i.current.clientWidth,b=window.innerHeight,N=(t-(l-1)*x)/l;return(Math.ceil(b/(N+x))+2)*l},[l,x]);n.useEffect(()=>{if(c.current)return a.current=new IntersectionObserver(t=>{const[b]=t;if(b.isIntersecting&&p<s.length){const j=o();w(N=>Math.min(N+j,s.length))}},{rootMargin:"200px"}),a.current.observe(c.current),()=>{a.current&&a.current.disconnect()}},[p,s.length,o]),n.useEffect(()=>{const t=()=>{const b=o();w(j=>Math.min(h+b,s.length))};return window.addEventListener("resize",t),t(),()=>{window.removeEventListener("resize",t)}},[h,s.length,o]);const v=s.slice(h,p),r=t=>{u&&u(t)},d=`repeat(${l}, 1fr)`;return e.jsxs("div",{ref:i,className:`w-full ${y}`,children:[e.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:d,gap:`${x}px`},children:v.map(t=>e.jsxs("div",{className:`cursor-pointer group relative overflow-hidden rounded-lg ${m}`,onClick:()=>r(t),children:[e.jsx($,{src:t.src,alt:t.alt||"Gallery image",className:"w-full h-full transition-transform duration-300",style:{transform:`scale(${t.scale||1})`,transformOrigin:"center center"},gallerySize:!0,loadingStrategy:f,sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"}),e.jsx("div",{className:"absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity"}),t.displayText&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-black bg-opacity-50 text-white",children:e.jsx("p",{className:"text-sm truncate",children:t.displayText})})]},t.id))}),p<s.length&&e.jsx("div",{ref:c,className:"w-full h-20 flex items-center justify-center mt-4",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),p>=s.length&&s.length>0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-4",children:"All images loaded"}),s.length===0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-8",children:"No images available"})]})},se={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},z={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},ce=()=>{const{getBannerImage:s,getScannerImages:u}=F();Y();const{theme:y}=G(),{state:m,dispatch:l}=U(),{questions:x}=H(),{sections:f}=Q(),[h,g]=n.useState(null),[p,w]=n.useState("");n.useEffect(()=>{l({type:"SET_QUESTIONS",payload:x})},[x,l]),n.useEffect(()=>{l({type:"SET_SECTIONS",payload:f})},[f,l]);const i=s(),[a,c]=n.useState([]);n.useEffect(()=>{try{const r=u();c(r),console.log("Scanner Images loaded:",r.length)}catch(r){console.error("Error loading scanner images:",r),c([])}},[u]);const o=(r,d)=>{l({type:"SET_ANSWER",payload:{questionId:r,value:d}})},v=r=>{const d=m.answers[r.id];switch(r.type){case"text":return e.jsx(_,{label:r.text,value:d||"",onChange:t=>o(r.id,t.target.value),required:r.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.text," ",r.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:r.options?.map(t=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer
                    transition-all duration-150 ease-in-out
                    ${d===t.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:r.id,value:t.value,checked:d===t.value,onChange:()=>o(r.id,t.value),className:"sr-only"}),t.imageUrl&&e.jsx("img",{src:t.imagePreview||t.imageUrl,alt:t.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${t.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:t.text})]},t.id))})]});case"boolean":return e.jsx(D,{label:r.text,checked:!!d,onChange:t=>o(r.id,t.target.checked),required:r.required});default:return null}};return e.jsx("div",{className:y==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200 futuristic-grid-bg",children:[e.jsx(J,{}),e.jsxs(S.div,{variants:se,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(S.div,{variants:z,className:"py-12 px-4 text-center",children:e.jsx(E,{text:"COMET Scanner Template Wizard",as:"h1",variant:"title",className:"text-5xl md:text-6xl lg:text-7xl font-bold font-display tracking-tight"})}),e.jsx(S.div,{variants:z,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800 holo-glow",children:i?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx($,{src:i.src,alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transform:`scale(${i.scale||1})`,transformOrigin:"center center"},loadingStrategy:"eager"})})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx(E,{text:"Visualize Your Data with COMET Scanner",as:"span",variant:"subtitle",className:"text-3xl font-semibold"})})})}),a.length>0&&e.jsxs(S.div,{variants:z,className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16",children:[e.jsx(E,{text:"Scanner Variations",as:"h2",variant:"title",className:"text-4xl md:text-5xl font-bold mb-8 text-center"}),e.jsx(te,{images:a,onImageClick:r=>{g(r.src),w(r.displayText||"Scanner Variation")},columnCount:3,itemGap:16,className:"mb-8",itemClassName:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105",loadingStrategy:"lazy"})]}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(S.div,{variants:z,children:[e.jsx(E,{text:"Configure Your Template",as:"h2",variant:"subtitle",className:"text-3xl font-bold mb-6"}),e.jsxs("div",{className:"space-y-6",children:[m.questions.map(r=>e.jsx("div",{className:"p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700 futuristic-container",children:v(r)},r.id)),m.questions.length===0&&e.jsx(E,{text:"No questions configured yet. Please set them up in the Admin Dashboard.",as:"p",className:"text-gray-500 dark:text-gray-400"})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(q,{})})]})]}),h&&e.jsx(Z,{isOpen:!0,onClose:()=>{g(null),w("")},title:p,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx("div",{className:"holo-glow",children:e.jsx($,{src:h,alt:p,className:"max-w-full max-h-[80vh] object-contain",loadingStrategy:"eager"})})})})})]})})};export{ce as default};
