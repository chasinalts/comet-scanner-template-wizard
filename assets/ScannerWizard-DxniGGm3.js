import{j as e,A as P,m as I}from"./vendor-ui-Bq_-EsXc.js";import{a as n}from"./vendor-react-Cmwg8GZL.js";import{m as M,r as F,u as H,a as Q,b as D,C as _,T as Y}from"./FormField-BzX3rPkv.js";import{a as A,g as U,u as G,b as J,T as K}from"./index-CytuPmTQ.js";import{H as E}from"./HolographicText-Ju8mWMBD.js";const X={hidden:{opacity:0},visible:{opacity:1}},Z={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},q=({isOpen:s,onClose:g,title:y,children:m,footer:o,size:u="md",showCloseButton:f=!0})=>{const h={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[u];return e.jsx(P,{mode:"wait",children:s&&e.jsxs(n.Fragment,{children:[e.jsx(I.div,{variants:X,initial:"hidden",animate:"visible",exit:"hidden",onClick:g,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(I.div,{variants:Z,initial:"hidden",animate:"visible",exit:"exit",className:`${h} w-full bg-white rounded-lg shadow-xl`,onClick:d=>d.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:y}),f&&e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:m}),o&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:o})]})})]})})},ee=()=>{const{state:s}=A(),{answers:g,sections:y,questions:m}=s,o=n.useMemo(()=>M(i=>i.filter(a=>a.isMandatory)),[]),u=n.useMemo(()=>M((i,a)=>i.find(c=>c.id===a)),[]),f=n.useMemo(()=>M((i,a)=>i.find(c=>c.id===a)),[]),h=n.useCallback((i,a,c)=>{const l=new RegExp(`{{\\s*${a}\\s*}}`,"g");return i.replace(l,c)},[]),d=n.useCallback(i=>{let a="";const c=new Set;return i.forEach(l=>{a+=`// --- Section: ${l.title} (Mandatory) ---
`,a+=l.code+`

`,c.add(l.id)}),{code:a,includedIds:c}},[]),p=n.useCallback((i,a,c,l)=>{let j="";return Object.entries(i).forEach(([r,x])=>{const t=u(a,r);if(!t)return;let b;if(t.type==="choice"&&x?(Array.isArray(x)?x:[x]).forEach(k=>{const C=t.options?.find(z=>z.value===k);C?.linkedSectionId&&(b=C.linkedSectionId)}):(t.type==="text"||t.type==="boolean")&&t.linkedSectionId&&(b=t.linkedSectionId),b&&!l.has(b)){const v=f(c,b);if(v){let k=v.code;t.type==="text"&&t.placeholderVariable&&typeof x=="string"&&(k=h(k,t.placeholderVariable,x)),j+=`// --- Section: ${v.title} (Linked by: ${t.text.substring(0,20)}...) ---
`,j+=k+`

`,l.add(v.id)}}else t.type==="text"&&t.placeholderVariable&&typeof x=="string"&&!b&&(j+=`// User input for "${t.text.substring(0,20)}...": ${x}

`)}),j},[u,f,h]),N=n.useMemo(()=>{const i=o(y),{code:a,includedIds:c}=d(i),l=p(g,m,y,c);return(a+l).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[g,y,m,o,d,p]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:N})})]})},te=(s={})=>{const[g,y]=n.useState(!1),m=n.useRef(null),{rootMargin:o="200px",threshold:u=0,triggerOnce:f=!0}=s;return n.useEffect(()=>{if(!m.current||g&&f)return;const h=m.current,d=new IntersectionObserver(p=>{const[N]=p;N.isIntersecting?(y(!0),f&&d.unobserve(h)):f||y(!1)},{rootMargin:o,threshold:u});return d.observe(h),()=>{d.unobserve(h),d.disconnect()}},[o,u,f,g]),{ref:m,isVisible:g}},R=({src:s,alt:g,className:y="",width:m,height:o,placeholderColor:u="#f3f4f6",style:f={},onClick:h,gallerySize:d=!1,sizes:p="100vw",loadingStrategy:N="lazy"})=>{const[i,a]=n.useState(null),[c,l]=n.useState(!1),[j,r]=n.useState(!1),{ref:x,isVisible:t}=te({rootMargin:N==="eager"?"400px":"200px",threshold:0,triggerOnce:!0}),b=s.includes("firebasestorage.googleapis.com"),v=s.includes("supabase.co/storage");n.useEffect(()=>{if(!t)return;let w=!0,$=null;const W=setTimeout(()=>{w&&!i&&!j&&console.log("Image loading taking longer than expected:",s)},3e3);return(async()=>{try{if(b&&!d){a(s),l(!0);return}if(v)try{const S=await U(s);if(w&&(a(S),!d)){l(!0);return}}catch(S){if(console.error("Error getting proxied URL:",S),w&&(a(s),!d)){l(!0);return}}if(d)try{const V=await(await fetch(s)).blob(),B=await F(V,400,400);w&&($=URL.createObjectURL(B),a($))}catch(S){console.warn(`Failed to resize image, using original: ${s}`,S),w&&a(s)}else a(s)}catch(S){console.error(`Failed to load image: ${s}`,S),w&&(r(!0),b&&(a(s),l(!0)))}})(),()=>{w=!1,clearTimeout(W),$&&URL.revokeObjectURL($)}},[t,s,d,b,v]);const k=()=>{l(!0)},C=()=>{r(!0),console.error(`Error loading image: ${s}`)},[z,T]=n.useState(void 0);n.useEffect(()=>{!s.startsWith("data:")&&!s.startsWith("blob:")?v?(async()=>{try{const w=await U(s);T(`${w} 1x, ${w} 2x`)}catch(w){console.error("Error generating srcSet:",w),T(`${s} 1x, ${s} 2x`)}})():T(`${s} 1x, ${s} 2x`):T(void 0)},[s,v]);const O=m&&o?o/m*100:0;return e.jsxs("div",{ref:x,className:`relative overflow-hidden ${y}`,style:{backgroundColor:u,paddingBottom:O?`${O}%`:void 0,...f},onClick:h,children:[i&&e.jsx("img",{src:i,alt:g,className:`transition-opacity duration-300 ${c?"opacity-100":"opacity-0"} absolute inset-0 w-full h-full object-contain`,onLoad:k,onError:C,width:m,height:o,sizes:p,srcSet:z}),(!i||!c)&&!j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),j&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-red-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})})]})},se=({images:s,onImageClick:g,className:y="",itemClassName:m="",columnCount:o=3,itemGap:u=16,loadingStrategy:f="lazy"})=>{const[h,d]=n.useState(0),[p,N]=n.useState(20),i=n.useRef(null),a=n.useRef(null),c=n.useRef(null),l=n.useCallback(()=>{if(!i.current)return 20;const t=i.current.clientWidth,b=window.innerHeight,k=(t-(o-1)*u)/o;return(Math.ceil(b/(k+u))+2)*o},[o,u]);n.useEffect(()=>{if(c.current)return a.current=new IntersectionObserver(t=>{const[b]=t;if(b.isIntersecting&&p<s.length){const v=l();N(k=>Math.min(k+v,s.length))}},{rootMargin:"200px"}),a.current.observe(c.current),()=>{a.current&&a.current.disconnect()}},[p,s.length,l]),n.useEffect(()=>{const t=()=>{const b=l();N(v=>Math.min(h+b,s.length))};return window.addEventListener("resize",t),t(),()=>{window.removeEventListener("resize",t)}},[h,s.length,l]);const j=s.slice(h,p),r=t=>{g&&g(t)},x=`repeat(${o}, 1fr)`;return e.jsxs("div",{ref:i,className:`w-full ${y}`,children:[e.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:x,gap:`${u}px`},children:j.map(t=>e.jsxs("div",{className:`cursor-pointer group relative overflow-hidden rounded-lg ${m}`,onClick:()=>r(t),children:[e.jsx(R,{src:t.src,alt:t.alt||"Gallery image",className:"w-full h-full transition-transform duration-300",style:{transform:`scale(${t.scale||1})`,transformOrigin:"center center"},gallerySize:!0,loadingStrategy:f,sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"}),e.jsx("div",{className:"absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity"}),t.displayText&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-black bg-opacity-50 text-white",children:e.jsx("p",{className:"text-sm truncate",children:t.displayText})})]},t.id))}),p<s.length&&e.jsx("div",{ref:c,className:"w-full h-20 flex items-center justify-center mt-4",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),p>=s.length&&s.length>0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-4",children:"All images loaded"}),s.length===0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-8",children:"No images available"})]})},re={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},L={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},de=()=>{const{getBannerImage:s,getScannerImages:g}=H();G();const{theme:y}=J(),{state:m,dispatch:o}=A(),{questions:u}=Q(),{sections:f}=D(),[h,d]=n.useState(null),[p,N]=n.useState("");n.useEffect(()=>{o({type:"SET_QUESTIONS",payload:u})},[u,o]),n.useEffect(()=>{o({type:"SET_SECTIONS",payload:f})},[f,o]);const i=s(),[a,c]=n.useState([]);n.useEffect(()=>{try{const r=g();c(r),console.log("Scanner Images loaded:",r.length)}catch(r){console.error("Error loading scanner images:",r),c([])}},[g]);const l=(r,x)=>{o({type:"SET_ANSWER",payload:{questionId:r,value:x}})},j=r=>{const x=m.answers[r.id];switch(r.type){case"text":return e.jsx(Y,{label:r.text,value:x||"",onChange:t=>l(r.id,t.target.value),required:r.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.text," ",r.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:r.options?.map(t=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer
                    transition-all duration-150 ease-in-out
                    ${x===t.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:r.id,value:t.value,checked:x===t.value,onChange:()=>l(r.id,t.value),className:"sr-only"}),t.imageUrl&&e.jsx("img",{src:t.imagePreview||t.imageUrl,alt:t.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${t.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:t.text})]},t.id))})]});case"boolean":return e.jsx(_,{label:r.text,checked:!!x,onChange:t=>l(r.id,t.target.checked),required:r.required});default:return null}};return e.jsx("div",{className:y==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200 futuristic-grid-bg",children:[e.jsx(K,{}),e.jsxs(I.div,{variants:re,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(I.div,{variants:L,className:"py-12 px-4 text-center",children:e.jsx(E,{text:"COMET Scanner Template Wizard",as:"h1",variant:"title",className:"text-5xl md:text-6xl lg:text-7xl font-bold font-display tracking-tight"})}),e.jsx(I.div,{variants:L,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800 holo-glow",children:i?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx(R,{src:i.src,alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transform:`scale(${i.scale||1})`,transformOrigin:"center center"},loadingStrategy:"eager"})})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx(E,{text:"Visualize Your Data with COMET Scanner",as:"span",variant:"subtitle",className:"text-3xl font-semibold"})})})}),a.length>0&&e.jsxs(I.div,{variants:L,className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16",children:[e.jsx(E,{text:"Scanner Variations",as:"h2",variant:"title",className:"text-4xl md:text-5xl font-bold mb-8 text-center"}),e.jsx(se,{images:a,onImageClick:r=>{d(r.src),N(r.displayText||"Scanner Variation")},columnCount:3,itemGap:16,className:"mb-8",itemClassName:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105",loadingStrategy:"lazy"})]}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(I.div,{variants:L,children:[e.jsx(E,{text:"Configure Your Template",as:"h2",variant:"subtitle",className:"text-3xl font-bold mb-6"}),e.jsxs("div",{className:"space-y-6",children:[m.questions.map(r=>e.jsx("div",{className:"p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700 futuristic-container",children:j(r)},r.id)),m.questions.length===0&&e.jsx(E,{text:"No questions configured yet. Please set them up in the Admin Dashboard.",as:"p",className:"text-gray-500 dark:text-gray-400"})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(ee,{})})]})]}),h&&e.jsx(q,{isOpen:!0,onClose:()=>{d(null),N("")},title:p,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx("div",{className:"holo-glow",children:e.jsx(R,{src:h,alt:p,className:"max-w-full max-h-[80vh] object-contain",loadingStrategy:"eager"})})})})})]})})};export{de as default};
