import{j as e,A as H,m as L}from"./vendor-ui-Bq_-EsXc.js";import{a}from"./vendor-react-Cmwg8GZL.js";import{m as R,r as Q,u as _,a as Y,b as G,C as K,T as q}from"./FormField-BsLkJXKY.js";import{c as W,g as V,a as J,d as X,T as Z,s as U,S as B}from"./index-DSA3-jpL.js";import{D as F}from"./DirectImage-Bpl8aNBA.js";import{H as M}from"./HolographicText-Ju8mWMBD.js";const ee={hidden:{opacity:0},visible:{opacity:1}},te={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},se=({isOpen:t,onClose:f,title:w,children:p,footer:c,size:u="md",showCloseButton:y=!0})=>{const h={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[u];return e.jsx(H,{mode:"wait",children:t&&e.jsxs(a.Fragment,{children:[e.jsx(L.div,{variants:ee,initial:"hidden",animate:"visible",exit:"hidden",onClick:f,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(L.div,{variants:te,initial:"hidden",animate:"visible",exit:"exit",className:`${h} w-full bg-white rounded-lg shadow-xl`,onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:w}),y&&e.jsx("button",{onClick:f,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:p}),c&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:c})]})})]})})},re=()=>{const{state:t}=W(),{answers:f,sections:w,questions:p}=t,c=a.useMemo(()=>R(l=>l.filter(n=>n.isMandatory)),[]),u=a.useMemo(()=>R((l,n)=>l.find(d=>d.id===n)),[]),y=a.useMemo(()=>R((l,n)=>l.find(d=>d.id===n)),[]),h=a.useCallback((l,n,d)=>{const i=new RegExp(`{{\\s*${n}\\s*}}`,"g");return l.replace(i,d)},[]),m=a.useCallback(l=>{let n="";const d=new Set;return l.forEach(i=>{n+=`// --- Section: ${i.title} (Mandatory) ---
`,n+=i.code+`

`,d.add(i.id)}),{code:n,includedIds:d}},[]),v=a.useCallback((l,n,d,i)=>{let S="";return Object.entries(l).forEach(([E,N])=>{const s=u(n,E);if(!s)return;let x;if(s.type==="choice"&&N?(Array.isArray(N)?N:[N]).forEach(k=>{const T=s.options?.find(r=>r.value===k);T?.linkedSectionId&&(x=T.linkedSectionId)}):(s.type==="text"||s.type==="boolean")&&s.linkedSectionId&&(x=s.linkedSectionId),x&&!i.has(x)){const j=y(d,x);if(j){let k=j.code;s.type==="text"&&s.placeholderVariable&&typeof N=="string"&&(k=h(k,s.placeholderVariable,N)),S+=`// --- Section: ${j.title} (Linked by: ${s.text.substring(0,20)}...) ---
`,S+=k+`

`,i.add(j.id)}}else s.type==="text"&&s.placeholderVariable&&typeof N=="string"&&!x&&(S+=`// User input for "${s.text.substring(0,20)}...": ${N}

`)}),S},[u,y,h]),I=a.useMemo(()=>{const l=c(w),{code:n,includedIds:d}=m(l),i=v(f,p,w,d);return(n+i).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[f,w,p,c,m,v]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:I})})]})},ae=(t={})=>{const[f,w]=a.useState(!1),p=a.useRef(null),{rootMargin:c="200px",threshold:u=0,triggerOnce:y=!0}=t;return a.useEffect(()=>{if(!p.current||f&&y)return;const h=p.current,m=new IntersectionObserver(v=>{const[I]=v;I.isIntersecting?(w(!0),y&&m.unobserve(h)):y||w(!1)},{rootMargin:c,threshold:u});return m.observe(h),()=>{m.unobserve(h),m.disconnect()}},[c,u,y,f]),{ref:p,isVisible:f}},A=({src:t,alt:f,className:w="",width:p,height:c,placeholderColor:u="#f3f4f6",style:y={},onClick:h,gallerySize:m=!1,sizes:v="100vw",loadingStrategy:I="lazy"})=>{const[l,n]=a.useState(null),[d,i]=a.useState(!1),[S,E]=a.useState(!1),{ref:N,isVisible:s}=ae({rootMargin:I==="eager"?"400px":"200px",threshold:0,triggerOnce:!0}),x=t.includes("firebasestorage.googleapis.com"),j=t.includes("supabase.co/storage")||t.includes("supabase.in/storage");a.useEffect(()=>{if(!s)return;let b=!0,$=null;const z=setTimeout(()=>{b&&!l&&!S&&console.log("Image loading taking longer than expected:",t)},3e3);return(async()=>{try{if(x&&!m){n(t),i(!0);return}if(j)try{const C=await V(t);if(b&&(n(C),!m)){i(!0);return}}catch(C){if(console.error("Error getting proxied URL:",C),b&&(n(t),!m)){i(!0);return}}if(m)try{const D=await(await fetch(t)).blob(),P=await Q(D,400,400);b&&($=URL.createObjectURL(P),n($))}catch(C){console.warn(`Failed to resize image, using original: ${t}`,C),b&&n(t)}else n(t)}catch(C){console.error(`Failed to load image: ${t}`,C),b&&(E(!0),x&&(n(t),i(!0)))}})(),()=>{b=!1,clearTimeout(z),$&&URL.revokeObjectURL($)}},[s,t,m,x,j]);const k=()=>{i(!0)},T=()=>{E(!0),console.error(`Error loading image: ${t}`)},[r,g]=a.useState(void 0);a.useEffect(()=>{!t.startsWith("data:")&&!t.startsWith("blob:")?j?(async()=>{try{const b=await V(t);g(`${b} 1x, ${b} 2x`)}catch(b){console.error("Error generating srcSet:",b),g(`${t} 1x, ${t} 2x`)}})():g(`${t} 1x, ${t} 2x`):g(void 0)},[t,j]);const o=p&&c?c/p*100:0;return e.jsxs("div",{ref:N,className:`relative overflow-hidden ${w}`,style:{backgroundColor:u,paddingBottom:o?`${o}%`:void 0,...y},onClick:h,children:[l&&e.jsx("img",{src:l,alt:f,className:`transition-opacity duration-300 ${d?"opacity-100":"opacity-0"} absolute inset-0 w-full h-full object-contain`,onLoad:k,onError:T,width:p,height:c,sizes:v,srcSet:r}),(!l||!d)&&!S&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),S&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-red-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})})]})},ne=({images:t,onImageClick:f,className:w="",itemClassName:p="",columnCount:c=3,itemGap:u=16,loadingStrategy:y="lazy"})=>{const[h,m]=a.useState(0),[v,I]=a.useState(20),l=a.useRef(null),n=a.useRef(null),d=a.useRef(null),i=a.useCallback(()=>{if(!l.current)return 20;const s=l.current.clientWidth,x=window.innerHeight,k=(s-(c-1)*u)/c;return(Math.ceil(x/(k+u))+2)*c},[c,u]);a.useEffect(()=>{if(d.current)return n.current=new IntersectionObserver(s=>{const[x]=s;if(x.isIntersecting&&v<t.length){const j=i();I(k=>Math.min(k+j,t.length))}},{rootMargin:"200px"}),n.current.observe(d.current),()=>{n.current&&n.current.disconnect()}},[v,t.length,i]),a.useEffect(()=>{const s=()=>{const x=i();I(j=>Math.min(h+x,t.length))};return window.addEventListener("resize",s),s(),()=>{window.removeEventListener("resize",s)}},[h,t.length,i]);const S=t.slice(h,v),E=s=>{f&&f(s)},N=`repeat(${c}, 1fr)`;return e.jsxs("div",{ref:l,className:`w-full ${w}`,children:[e.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:N,gap:`${u}px`},children:S.map(s=>e.jsxs("div",{className:`cursor-pointer group relative overflow-hidden rounded-lg ${p}`,onClick:()=>E(s),children:[e.jsx(A,{src:s.src,alt:s.alt||"Gallery image",className:"w-full h-full transition-transform duration-300",style:{transform:`scale(${s.scale||1})`,transformOrigin:"center center"},gallerySize:!0,loadingStrategy:y,sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"}),e.jsx("div",{className:"absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity"}),s.displayText&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-black bg-opacity-50 text-white",children:e.jsx("p",{className:"text-sm truncate",children:s.displayText})})]},s.id))}),v<t.length&&e.jsx("div",{ref:d,className:"w-full h-20 flex items-center justify-center mt-4",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),v>=t.length&&t.length>0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-4",children:"All images loaded"}),t.length===0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-8",children:"No images available"})]})},ie={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},O={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},xe=()=>{const{getBannerImage:t,getScannerImages:f,isLoading:w}=_();J();const{theme:p}=X(),{state:c,dispatch:u}=W(),{questions:y}=Y(),{sections:h}=G(),[m,v]=a.useState(null),[I,l]=a.useState(""),[n,d]=a.useState(!0);a.useEffect(()=>{u({type:"SET_QUESTIONS",payload:y})},[y,u]),a.useEffect(()=>{u({type:"SET_SECTIONS",payload:h})},[h,u]);const i=t(),[S,E]=a.useState([]),[N,s]=a.useState([]),[x,j]=a.useState([]);a.useEffect(()=>{(async()=>{try{const{data:g,error:o}=await U.storage.from(B).list("banner");o?console.error("Error fetching banner files:",o):g&&g.length>0&&(console.log("Direct banner files:",g),s(g.map(z=>`banner/${z.name}`)));const{data:b,error:$}=await U.storage.from(B).list("scanner");$?console.error("Error fetching scanner files:",$):b&&b.length>0&&(console.log("Direct scanner files:",b),j(b.map(z=>`scanner/${z.name}`)))}catch(g){console.error("Error fetching direct images:",g)}})()},[]),a.useEffect(()=>{d(!0);try{const r=f();E(r),console.log("Scanner Images loaded:",r.length)}catch(r){console.error("Error loading scanner images:",r),E([])}finally{d(!1)}},[f,w]);const k=(r,g)=>{u({type:"SET_ANSWER",payload:{questionId:r,value:g}})},T=r=>{const g=c.answers[r.id];switch(r.type){case"text":return e.jsx(q,{label:r.text,value:g||"",onChange:o=>k(r.id,o.target.value),required:r.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.text," ",r.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:r.options?.map(o=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer
                    transition-all duration-150 ease-in-out
                    ${g===o.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:r.id,value:o.value,checked:g===o.value,onChange:()=>k(r.id,o.value),className:"sr-only"}),o.imageUrl&&e.jsx("img",{src:o.imagePreview||o.imageUrl,alt:o.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${o.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:o.text})]},o.id))})]});case"boolean":return e.jsx(K,{label:r.text,checked:!!g,onChange:o=>k(r.id,o.target.checked),required:r.required});default:return null}};return e.jsx("div",{className:p==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200 futuristic-grid-bg",children:[e.jsx(Z,{}),e.jsxs(L.div,{variants:ie,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(L.div,{variants:O,className:"py-12 px-4 text-center",children:e.jsx(M,{text:"COMET Scanner Template Wizard",as:"h1",variant:"title",className:"text-5xl md:text-6xl lg:text-7xl font-bold font-display tracking-tight"})}),e.jsx(L.div,{variants:O,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800 holo-glow",children:N.length>0?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx(F,{path:N[0],alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transformOrigin:"center center"}})})}):w?e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin"})})}):i?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsxs("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:[e.jsx(A,{src:i.src,alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transform:`scale(${i.scale||1})`,transformOrigin:"center center"},loadingStrategy:"eager"}),i.displayText&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl text-white font-semibold bg-black bg-opacity-30 px-6 py-3 rounded-lg",children:i.displayText})})]})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx(M,{text:"Visualize Your Data with COMET Scanner",as:"span",variant:"subtitle",className:"text-3xl font-semibold"})})})}),e.jsxs(L.div,{variants:O,className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16",children:[e.jsx(M,{text:"Scanner Variations",as:"h2",variant:"title",className:"text-4xl md:text-5xl font-bold mb-8 text-center"}),x.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6",children:x.map((r,g)=>e.jsx("div",{className:"aspect-square bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105 cursor-pointer",onClick:()=>{const{data:o}=U.storage.from(B).getPublicUrl(r);v(o.publicUrl),l(`Scanner Variation ${g+1}`)},children:e.jsx(F,{path:r,alt:`Scanner Variation ${g+1}`,className:"w-full h-full object-cover"})},r))}):n?e.jsx("div",{className:"flex justify-center items-center py-16",children:e.jsx("div",{className:"w-16 h-16 border-4 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}):S.length>0?e.jsx(ne,{images:S,onImageClick:r=>{v(r.src),l(r.displayText||"Scanner Variation")},columnCount:3,itemGap:16,className:"mb-8",itemClassName:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105",loadingStrategy:"lazy"}):e.jsx("div",{className:"text-center py-12 border border-gray-200 dark:border-gray-700 rounded-lg",children:e.jsx(M,{text:"No scanner variations available",as:"p",className:"text-gray-500 dark:text-gray-400"})})]}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(L.div,{variants:O,children:[e.jsx(M,{text:"Configure Your Template",as:"h2",variant:"subtitle",className:"text-3xl font-bold mb-6"}),e.jsxs("div",{className:"space-y-6",children:[c.questions.map(r=>e.jsx("div",{className:"p-6 rounded-lg shadow border border-gray-200 dark:border-gray-700 futuristic-container",children:T(r)},r.id)),c.questions.length===0&&e.jsx(M,{text:"No questions configured yet. Please set them up in the Admin Dashboard.",as:"p",className:"text-gray-500 dark:text-gray-400"})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(re,{})})]})]}),m&&e.jsx(se,{isOpen:!0,onClose:()=>{v(null),l("")},title:I,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx("div",{className:"holo-glow",children:m.includes("supabase")?e.jsx("img",{src:m,alt:I,className:"max-w-full max-h-[80vh] object-contain"}):e.jsx(A,{src:m,alt:I,className:"max-w-full max-h-[80vh] object-contain",loadingStrategy:"eager"})})})})})]})})};export{xe as default};
