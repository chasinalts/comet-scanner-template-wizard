var v=Object.defineProperty;var j=(t,e,n)=>e in t?v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var p=(t,e,n)=>j(t,typeof e!="symbol"?e+"":e,n);import{a as l}from"./vendor-react-V1NwqAnN.js";import{j as m,m as N}from"./vendor-ui-CMso90iE.js";class C{constructor(e=100){p(this,"cache");p(this,"maxSize");this.cache=new Map,this.maxSize=e}get(e){const n=this.cache.get(e);if(n){if(n.expiry&&Date.now()>n.expiry){this.cache.delete(e);return}return this.cache.delete(e),this.cache.set(e,n),n.value}}set(e,n,i=null){if(this.cache.size>=this.maxSize){const s=this.cache.keys().next().value;s&&this.cache.delete(s)}const r=i?Date.now()+i:null;this.cache.set(e,{value:n,expiry:r})}clear(){this.cache.clear()}}function h(t,e={}){const{maxCacheSize:n=100,ttl:i=null}=e,r=new C(n),s=(...a)=>{const c=JSON.stringify(a),u=r.get(c);if(u!==void 0)return u;const g=t(...a);return g instanceof Promise?(r.set(c,g,i),g.then(f=>(r.set(c,f,i),f)).catch(f=>{throw r.get(c)===g&&r.set(c,void 0,0),f})):(r.set(c,g,i),g)};return s.clearCache=()=>{r.clear()},s}const L=()=>{const[t,e]=l.useState([]);l.useEffect(()=>{const d=()=>{const b=localStorage.getItem("admin_contents");b&&e(JSON.parse(b))};d();const o=b=>{b.key==="admin_contents"&&d()};return window.addEventListener("storage",o),()=>window.removeEventListener("storage",o)},[]);const n=l.useMemo(()=>h(d=>d.filter(o=>o.type==="banner")),[]),i=l.useCallback(()=>{const d=n(t);if(d.length===0)return null;const o=d[d.length-1];return{id:o.id,src:o.imageUrl||"",alt:o.title,scale:o.scale,displayText:o.displayText}},[t,n]),r=l.useMemo(()=>h(d=>d.filter(o=>o.type==="scanner")),[]),s=l.useMemo(()=>h(d=>[...d].sort((o,b)=>b.updatedAt-o.updatedAt)),[]),a=l.useMemo(()=>h(d=>d.map(o=>({id:o.id,src:o.imageUrl||"",alt:o.title,scale:o.scale,displayText:o.displayText}))),[]),c=l.useCallback(()=>{const d=r(t),o=s(d);return a(o)},[t,r,s,a]),u=l.useMemo(()=>h(d=>d.filter(o=>o.type==="template")),[]),g=l.useMemo(()=>h(d=>d.map(o=>({id:o.id,title:o.title,code:o.content}))),[]),f=l.useCallback(()=>{const d=u(t),o=s(d);return g(o)},[t,u,s,g]),w=l.useMemo(()=>h(d=>d.filter(o=>o.type==="question")),[]),y=l.useMemo(()=>h(d=>d.map(o=>({id:o.id,title:o.title,text:o.content}))),[]),S=l.useCallback(()=>{const d=w(t),o=s(d);return y(o)},[t,w,s,y]);return l.useMemo(()=>({getBannerImage:i,getScannerImages:c,getTemplates:f,getQuestions:S,hasContent:t.length>0}),[i,c,f,S,t.length])},Q=(t,e)=>{const n=URL.createObjectURL(t),i=new FileReader;i.onloadend=()=>{const r=i.result;console.log("Image uploaded:",{file:t,imageUrl:r.substring(0,50)+"...",imagePreview:n}),e(r,n)},i.readAsDataURL(t)},U=t=>{t.startsWith("blob:")&&URL.revokeObjectURL(t)},M=(t,e,n)=>new Promise((i,r)=>{const s=new Image;s.src=URL.createObjectURL(t),s.onload=()=>{let a=s.width,c=s.height;a>e&&(c=c*e/a,a=e),c>n&&(a=a*n/c,c=n);const u=document.createElement("canvas");u.width=a,u.height=c;const g=u.getContext("2d");if(!g){r(new Error("Could not get canvas context"));return}g.drawImage(s,0,0,a,c),u.toBlob(f=>{f?i(f):r(new Error("Could not create blob from canvas"))},t.type),URL.revokeObjectURL(s.src)},s.onerror=()=>{r(new Error("Failed to load image")),URL.revokeObjectURL(s.src)}}),O=()=>{const[t,e]=l.useState(()=>{const s=localStorage.getItem("admin_questions");return s?JSON.parse(s):[]});return l.useEffect(()=>{localStorage.setItem("admin_questions",JSON.stringify(t))},[t]),l.useEffect(()=>()=>{t.forEach(s=>{s.options?.forEach(a=>{a.imagePreview&&U(a.imagePreview)})})},[t]),{questions:t,setQuestions:e,addQuestion:s=>{const a={id:`question-${Date.now()}`,type:s,text:"",required:!1,...s==="choice"&&{options:[]},...s==="text"&&{placeholderVariable:""}};e(c=>[...c,a])},updateQuestion:(s,a)=>{e(c=>c.map(u=>u.id===s?{...u,...a}:u))},deleteQuestion:s=>{e(a=>a.filter(c=>c.id!==s))}}},T=()=>{const[t,e]=l.useState(()=>{const a=localStorage.getItem("admin_sections");return a?JSON.parse(a):[]});return l.useEffect(()=>{localStorage.setItem("admin_sections",JSON.stringify(t))},[t]),{sections:t,setSections:e,addSection:()=>{const a={id:`section-${Date.now()}`,title:"New Section",code:"",isMandatory:!1};e(c=>[...c,a])},updateSection:(a,c)=>{e(u=>u.map(g=>g.id===a?{...g,...c}:g))},deleteSection:a=>{e(c=>c.filter(u=>u.id!==a))},reorderSections:a=>{e(a)}}},x=({label:t,error:e,helperText:n,required:i,children:r,fullWidth:s=!1})=>m.jsxs("div",{className:`${s?"w-full":""} space-y-1`,children:[t&&m.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[t,i&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),m.jsx("div",{className:"mt-1",children:r}),(e||n)&&m.jsx("div",{className:"mt-1",children:e?m.jsx(N.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-sm text-red-600",children:e}):n?m.jsx("p",{className:"text-sm text-gray-500",children:n}):null})]}),$=({label:t,error:e,helperText:n,required:i,fullWidth:r,...s})=>m.jsx(x,{label:t,error:e,helperText:n,required:i,fullWidth:r,children:m.jsx("input",{className:`
          block rounded-md shadow-sm
          ${r?"w-full":"w-auto"}
          ${e?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...s})}),z=({label:t,error:e,helperText:n,required:i,fullWidth:r,...s})=>m.jsx(x,{label:t,error:e,helperText:n,required:i,fullWidth:r,children:m.jsx("textarea",{className:`
          block rounded-md shadow-sm
          ${r?"w-full":"w-auto"}
          ${e?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...s})}),F=({label:t,error:e,helperText:n,required:i,fullWidth:r,children:s,...a})=>m.jsx(x,{label:t,error:e,helperText:n,required:i,fullWidth:r,children:m.jsx("select",{className:`
          block rounded-md shadow-sm
          ${r?"w-full":"w-auto"}
          ${e?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...a,children:s})}),A=({label:t,error:e,helperText:n,required:i,...r})=>m.jsx(x,{error:e,helperText:n,required:i,children:m.jsxs("div",{className:"flex items-center",children:[m.jsx("input",{type:"checkbox",className:`
            rounded border-gray-300 text-blue-600 shadow-sm
            focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 focus:ring-opacity-50
            ${e?"border-red-500":""}
          `,...r}),t&&m.jsxs("label",{className:"ml-2 block text-sm text-gray-900",children:[t,i&&m.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})]})});export{A as C,F as S,$ as T,O as a,T as b,U as c,z as d,Q as h,h as m,M as r,L as u};
