import{j as e,A,m as k}from"./vendor-ui-CMso90iE.js";import{a}from"./vendor-react-V1NwqAnN.js";import{m as z,r as W,u as V,a as B,b as U,C as P,T as F}from"./FormField-Cp-MkgIj.js";import{a as $,u as Q,b as D,T as H}from"./index-DVQGbPOG.js";const _={hidden:{opacity:0},visible:{opacity:1}},Y={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},G=({isOpen:r,onClose:m,title:p,children:x,footer:l,size:g="md",showCloseButton:f=!0})=>{const u={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[g];return e.jsx(A,{mode:"wait",children:r&&e.jsxs(a.Fragment,{children:[e.jsx(k.div,{variants:_,initial:"hidden",animate:"visible",exit:"hidden",onClick:m,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(k.div,{variants:Y,initial:"hidden",animate:"visible",exit:"exit",className:`${u} w-full bg-white rounded-lg shadow-xl`,onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:p}),f&&e.jsx("button",{onClick:m,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:x}),l&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:l})]})})]})})},J=()=>{const{state:r}=$(),{answers:m,sections:p,questions:x}=r,l=a.useMemo(()=>z(i=>i.filter(n=>n.isMandatory)),[]),g=a.useMemo(()=>z((i,n)=>i.find(o=>o.id===n)),[]),f=a.useMemo(()=>z((i,n)=>i.find(o=>o.id===n)),[]),u=a.useCallback((i,n,o)=>{const c=new RegExp(`{{\\s*${n}\\s*}}`,"g");return i.replace(c,o)},[]),h=a.useCallback(i=>{let n="";const o=new Set;return i.forEach(c=>{n+=`// --- Section: ${c.title} (Mandatory) ---
`,n+=c.code+`

`,o.add(c.id)}),{code:n,includedIds:o}},[]),y=a.useCallback((i,n,o,c)=>{let v="";return Object.entries(i).forEach(([s,d])=>{const t=g(n,s);if(!t)return;let b;if(t.type==="choice"&&d?(Array.isArray(d)?d:[d]).forEach(N=>{const S=t.options?.find(I=>I.value===N);S?.linkedSectionId&&(b=S.linkedSectionId)}):(t.type==="text"||t.type==="boolean")&&t.linkedSectionId&&(b=t.linkedSectionId),b&&!c.has(b)){const w=f(o,b);if(w){let N=w.code;t.type==="text"&&t.placeholderVariable&&typeof d=="string"&&(N=u(N,t.placeholderVariable,d)),v+=`// --- Section: ${w.title} (Linked by: ${t.text.substring(0,20)}...) ---
`,v+=N+`

`,c.add(w.id)}}else t.type==="text"&&t.placeholderVariable&&typeof d=="string"&&!b&&(v+=`// User input for "${t.text.substring(0,20)}...": ${d}

`)}),v},[g,f,u]),j=a.useMemo(()=>{const i=l(p),{code:n,includedIds:o}=h(i),c=y(m,x,p,o);return(n+c).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[m,p,x,l,h,y]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:j})})]})},K=(r={})=>{const[m,p]=a.useState(!1),x=a.useRef(null),{rootMargin:l="200px",threshold:g=0,triggerOnce:f=!0}=r;return a.useEffect(()=>{if(!x.current||m&&f)return;const u=x.current,h=new IntersectionObserver(y=>{const[j]=y;j.isIntersecting?(p(!0),f&&h.unobserve(u)):f||p(!1)},{rootMargin:l,threshold:g});return h.observe(u),()=>{h.unobserve(u),h.disconnect()}},[l,g,f,m]),{ref:x,isVisible:m}},L=({src:r,alt:m,className:p="",width:x,height:l,placeholderColor:g="#f3f4f6",style:f={},onClick:u,gallerySize:h=!1,sizes:y="100vw",loadingStrategy:j="lazy"})=>{const[i,n]=a.useState(null),[o,c]=a.useState(!1),[v,s]=a.useState(!1),{ref:d,isVisible:t}=K({rootMargin:j==="eager"?"400px":"200px",threshold:0,triggerOnce:!0}),b=r.includes("firebasestorage.googleapis.com");a.useEffect(()=>{if(!t||i||v)return;let T=!0,C=null;return(async()=>{try{if(b&&!h){n(r);return}if(h){const R=await(await fetch(r)).blob(),O=await W(R,400,400);T&&(C=URL.createObjectURL(O),n(C))}else n(r)}catch(M){console.error(`Failed to load image: ${r}`,M),T&&(s(!0),b&&n(r))}})(),()=>{T=!1,C&&URL.revokeObjectURL(C)}},[t,r,h,b,i,v]);const w=()=>{c(!0)},N=()=>{s(!0),console.error(`Error loading image: ${r}`)},S=()=>{if(!r.startsWith("data:")&&!r.startsWith("blob:"))return`${r} 1x, ${r} 2x`},I=x&&l?l/x*100:0;return e.jsxs("div",{ref:d,className:`relative overflow-hidden ${p}`,style:{backgroundColor:g,paddingBottom:I?`${I}%`:void 0,...f},onClick:u,children:[i&&e.jsx("img",{src:i,alt:m,className:`transition-opacity duration-300 ${o?"opacity-100":"opacity-0"} absolute inset-0 w-full h-full object-contain`,onLoad:w,onError:N,width:x,height:l,sizes:y,srcSet:S()}),(!i||!o)&&!v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-red-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})})]})},X=({images:r,onImageClick:m,className:p="",itemClassName:x="",columnCount:l=3,itemGap:g=16,loadingStrategy:f="lazy"})=>{const[u,h]=a.useState(0),[y,j]=a.useState(20),i=a.useRef(null),n=a.useRef(null),o=a.useRef(null),c=a.useCallback(()=>{if(!i.current)return 20;const t=i.current.clientWidth,b=window.innerHeight,N=(t-(l-1)*g)/l;return(Math.ceil(b/(N+g))+2)*l},[l,g]);a.useEffect(()=>{if(o.current)return n.current=new IntersectionObserver(t=>{const[b]=t;if(b.isIntersecting&&y<r.length){const w=c();j(N=>Math.min(N+w,r.length))}},{rootMargin:"200px"}),n.current.observe(o.current),()=>{n.current&&n.current.disconnect()}},[y,r.length,c]),a.useEffect(()=>{const t=()=>{const b=c();j(w=>Math.min(u+b,r.length))};return window.addEventListener("resize",t),t(),()=>{window.removeEventListener("resize",t)}},[u,r.length,c]);const v=r.slice(u,y),s=t=>{m&&m(t)},d=`repeat(${l}, 1fr)`;return e.jsxs("div",{ref:i,className:`w-full ${p}`,children:[e.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:d,gap:`${g}px`},children:v.map(t=>e.jsxs("div",{className:`cursor-pointer group relative overflow-hidden rounded-lg ${x}`,onClick:()=>s(t),children:[e.jsx(L,{src:t.src,alt:t.alt||"Gallery image",className:"w-full h-full transition-transform duration-300",style:{transform:`scale(${t.scale||1})`,transformOrigin:"center center"},gallerySize:!0,loadingStrategy:f,sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"}),e.jsx("div",{className:"absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity"}),t.displayText&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-black bg-opacity-50 text-white",children:e.jsx("p",{className:"text-sm truncate",children:t.displayText})})]},t.id))}),y<r.length&&e.jsx("div",{ref:o,className:"w-full h-20 flex items-center justify-center mt-4",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),y>=r.length&&r.length>0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-4",children:"All images loaded"}),r.length===0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-8",children:"No images available"})]})},Z={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},E={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},ae=()=>{const{getBannerImage:r,getScannerImages:m}=V();Q();const{theme:p}=D(),{state:x,dispatch:l}=$(),{questions:g}=B(),{sections:f}=U(),[u,h]=a.useState(null),[y,j]=a.useState("");a.useEffect(()=>{l({type:"SET_QUESTIONS",payload:g})},[g,l]),a.useEffect(()=>{l({type:"SET_SECTIONS",payload:f})},[f,l]);const i=r(),[n,o]=a.useState([]);a.useEffect(()=>{try{const s=m();o(s),console.log("Scanner Images loaded:",s.length)}catch(s){console.error("Error loading scanner images:",s),o([])}},[m]);const c=(s,d)=>{l({type:"SET_ANSWER",payload:{questionId:s,value:d}})},v=s=>{const d=x.answers[s.id];switch(s.type){case"text":return e.jsx(F,{label:s.text,value:d||"",onChange:t=>c(s.id,t.target.value),required:s.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[s.text," ",s.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:s.options?.map(t=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer
                    transition-all duration-150 ease-in-out
                    ${d===t.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:s.id,value:t.value,checked:d===t.value,onChange:()=>c(s.id,t.value),className:"sr-only"}),t.imageUrl&&e.jsx("img",{src:t.imagePreview||t.imageUrl,alt:t.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${t.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:t.text})]},t.id))})]});case"boolean":return e.jsx(P,{label:s.text,checked:!!d,onChange:t=>c(s.id,t.target.checked),required:s.required});default:return null}};return e.jsx("div",{className:p==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200",children:[e.jsx(H,{}),e.jsxs(k.div,{variants:Z,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(k.div,{variants:E,className:"py-12 px-4 text-center",children:e.jsx("h1",{className:"text-5xl md:text-6xl lg:text-7xl font-bold text-gray-900 dark:text-white font-display tracking-tight",children:"COMET Scanner Template Wizard"})}),e.jsx(k.div,{variants:E,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800",children:i?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx(L,{src:i.src,alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transform:`scale(${i.scale||1})`,transformOrigin:"center center"},loadingStrategy:"eager"})})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl text-white font-semibold",children:"Visualize Your Data with COMET Scanner"})})})}),n.length>0&&e.jsxs(k.div,{variants:E,className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-8 text-center",children:"Scanner Variations"}),e.jsx(X,{images:n,onImageClick:s=>{h(s.src),j(s.displayText||"Scanner Variation")},columnCount:3,itemGap:16,className:"mb-8",itemClassName:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105",loadingStrategy:"lazy"})]}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(k.div,{variants:E,children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-6",children:"Configure Your Template"}),e.jsxs("div",{className:"space-y-6",children:[x.questions.map(s=>e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:v(s)},s.id)),x.questions.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No questions configured yet. Please set them up in the Admin Dashboard."})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(J,{})})]})]}),u&&e.jsx(G,{isOpen:!0,onClose:()=>{h(null),j("")},title:y,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx(L,{src:u,alt:y,className:"max-w-full max-h-[80vh] object-contain",loadingStrategy:"eager"})})})})]})})};export{ae as default};
