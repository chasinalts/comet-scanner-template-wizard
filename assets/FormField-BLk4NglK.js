var C=Object.defineProperty;var j=(e,t,s)=>t in e?C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var v=(e,t,s)=>j(e,typeof t!="symbol"?t+"":t,s);import{a as m}from"./vendor-react-CSTjpmlB.js";import{r as z,s as L,f as N,S as U,h as E}from"./index-2e4mMjDP.js";import{j as h,m as O}from"./vendor-ui-C2WKSLH5.js";class M{constructor(t=100){v(this,"cache");v(this,"maxSize");this.cache=new Map,this.maxSize=t}get(t){const s=this.cache.get(t);if(s){if(s.expiry&&Date.now()>s.expiry){this.cache.delete(t);return}return this.cache.delete(t),this.cache.set(t,s),s.value}}set(t,s,r=null){if(this.cache.size>=this.maxSize){const o=this.cache.keys().next().value;o&&this.cache.delete(o)}const n=r?Date.now()+r:null;this.cache.set(t,{value:s,expiry:n})}clear(){this.cache.clear()}}function b(e,t={}){const{maxCacheSize:s=100,ttl:r=null}=t,n=new M(s),o=(...a)=>{const c=JSON.stringify(a),l=n.get(c);if(l!==void 0)return l;const u=e(...a);return u instanceof Promise?(n.set(c,u,r),u.then(g=>(n.set(c,g,r),g)).catch(g=>{throw n.get(c)===u&&n.set(c,void 0,0),g})):(n.set(c,u,r),u)};return o.clearCache=()=>{n.clear()},o}const Z=()=>{const[e,t]=m.useState([]);m.useEffect(()=>{const d=()=>{const y=localStorage.getItem("admin_contents");y&&t(JSON.parse(y))};d();const i=y=>{y.key==="admin_contents"&&d()};return window.addEventListener("storage",i),()=>window.removeEventListener("storage",i)},[]);const s=m.useMemo(()=>b(d=>d.filter(i=>i.type==="banner")),[]),r=m.useCallback(()=>{const d=s(e);if(d.length===0)return null;const i=d[d.length-1];return{id:i.id,src:i.imageUrl||"",alt:i.title,scale:i.scale,displayText:i.displayText}},[e,s]),n=m.useMemo(()=>b(d=>d.filter(i=>i.type==="scanner")),[]),o=m.useMemo(()=>b(d=>[...d].sort((i,y)=>y.updatedAt-i.updatedAt)),[]),a=m.useMemo(()=>b(d=>d.map(i=>({id:i.id,src:i.imageUrl||"",alt:i.title,scale:i.scale,displayText:i.displayText}))),[]),c=m.useCallback(()=>{const d=n(e),i=o(d);return a(i)},[e,n,o,a]),l=m.useMemo(()=>b(d=>d.filter(i=>i.type==="template")),[]),u=m.useMemo(()=>b(d=>d.map(i=>({id:i.id,title:i.title,code:i.content}))),[]),g=m.useCallback(()=>{const d=l(e),i=o(d);return u(i)},[e,l,o,u]),x=m.useMemo(()=>b(d=>d.filter(i=>i.type==="question")),[]),w=m.useMemo(()=>b(d=>d.map(i=>({id:i.id,title:i.title,text:i.content}))),[]),f=m.useCallback(()=>{const d=x(e),i=o(d);return w(i)},[e,x,o,w]);return m.useMemo(()=>({getBannerImage:r,getScannerImages:c,getTemplates:g,getQuestions:f,hasContent:e.length>0}),[r,c,g,f,e.length])},p=[];for(let e=0;e<256;++e)p.push((e+256).toString(16).slice(1));function k(e,t=0){return(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase()}let R;const T=new Uint8Array(16);function $(){if(!R){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");R=crypto.getRandomValues.bind(crypto)}return R(T)}const Q=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),F={randomUUID:Q};function P(e,t,s){if(F.randomUUID&&!e)return F.randomUUID();e=e||{};const r=e.random??e.rng?.()??$();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,k(r)}const D=async e=>{try{const t=decodeURIComponent(e),s=t.indexOf("/o/")+3,r=t.indexOf("?");if(s===-1||r===-1){console.error("Invalid Firebase Storage URL format:",e);return}const n=t.substring(s,r),o=z(L,n);await N(o),console.log("File deleted successfully:",n)}catch(t){throw console.error("Error deleting file from Firebase Storage:",t),t}},B=async(e,t,s="public, max-age=31536000")=>{try{const r=e.name.split(".").pop(),n=`${P()}.${r}`,o=`${t}/${n}`,{data:a,error:c}=await E.storage.from(U).upload(o,e,{cacheControl:s,upsert:!1,contentType:e.type});if(c)throw console.error("Error uploading file to Supabase Storage:",c),c;const{data:{publicUrl:l}}=E.storage.from(U).getPublicUrl(a.path);return console.log("File uploaded successfully to Supabase Storage:",l),l}catch(r){throw console.error("Error uploading file to Supabase Storage:",r),r}},q=async e=>{try{const s=new URL(e).pathname.split("/"),r=s.findIndex(a=>a===U);if(r===-1||r===s.length-1){console.error("Invalid Supabase Storage URL format:",e);return}const n=s.slice(r+1).join("/"),{error:o}=await E.storage.from(U).remove([n]);if(o)throw console.error("Error deleting file from Supabase Storage:",o),o;console.log("File deleted successfully from Supabase Storage:",n)}catch(t){throw console.error("Error deleting file from Supabase Storage:",t),t}},A=async(e,t=1920,s=1080,r=.8)=>new Promise((n,o)=>{try{const a=new FileReader;a.onload=c=>{const l=new Image;l.onload=()=>{let u=l.width,g=l.height;if(u>t||g>s){const f=Math.min(t/u,s/g);u=Math.floor(u*f),g=Math.floor(g*f)}const x=document.createElement("canvas");x.width=u,x.height=g;const w=x.getContext("2d");if(!w){o(new Error("Could not get canvas context"));return}w.drawImage(l,0,0,u,g),x.toBlob(f=>{if(!f){o(new Error("Could not create blob from canvas"));return}const S=new File([f],e.name,{type:e.type,lastModified:Date.now()});console.log("Image compression results:",{originalSize:e.size,compressedSize:S.size,compressionRatio:(S.size/e.size*100).toFixed(2)+"%",dimensions:`${u}x${g}`}),n(S)},e.type,r)},l.onerror=()=>{o(new Error("Failed to load image for compression"))},typeof c.target?.result=="string"?l.src=c.target.result:o(new Error("Failed to read file"))},a.onerror=()=>{o(new Error("Failed to read file"))},a.readAsDataURL(e)}catch(a){o(a)}}),_=(e,t=1)=>{const s=t*1024*1024;return e.size>s},J=async(e,t={maxWidth:1920,maxHeight:1080,quality:.8,maxSizeInMB:1})=>{try{const s=_(e,t.maxSizeInMB)?t.quality:.92;return console.log(`Processing image with quality: ${s}`),await A(e,t.maxWidth,t.maxHeight,s)}catch(s){return console.error("Error processing image, using original:",s),e}},V=(e,t,s,r)=>{try{const n=URL.createObjectURL(e);(async()=>{try{const o=await J(e,{maxWidth:1920,maxHeight:1080,quality:.85,maxSizeInMB:1}),c=await B(o,t);console.log("Image uploaded to Supabase:",{originalSize:e.size,processedSize:o.size,compressionRatio:(o.size/e.size*100).toFixed(2)+"%",imageUrl:c}),s(c,n),setTimeout(()=>{URL.revokeObjectURL(n)},5e3)}catch(o){if(console.error("Error in image processing or upload:",o),URL.revokeObjectURL(n),r)r(o);else throw o}})()}catch(n){if(console.error("Error in handleSupabaseImageUpload:",n),r)r(n);else throw n}},W=(e,t,s,r)=>V(e,t,s,r),K=async(e,t=!1)=>{if(e.startsWith("blob:"))URL.revokeObjectURL(e);else if(t)try{e.includes("firebasestorage.googleapis.com")?await D(e):e.includes("supabase")&&await q(e)}catch(s){console.error("Error deleting file from cloud storage:",s)}},ee=(e,t,s)=>new Promise((r,n)=>{const o=new Image;o.src=URL.createObjectURL(e),o.onload=()=>{let a=o.width,c=o.height;a>t&&(c=c*t/a,a=t),c>s&&(a=a*s/c,c=s);const l=document.createElement("canvas");l.width=a,l.height=c;const u=l.getContext("2d");if(!u){n(new Error("Could not get canvas context"));return}u.drawImage(o,0,0,a,c),l.toBlob(g=>{g?r(g):n(new Error("Could not create blob from canvas"))},e.type),URL.revokeObjectURL(o.src)},o.onerror=()=>{n(new Error("Failed to load image")),URL.revokeObjectURL(o.src)}}),te=()=>{const[e,t]=m.useState(()=>{const o=localStorage.getItem("admin_questions");return o?JSON.parse(o):[]});return m.useEffect(()=>{localStorage.setItem("admin_questions",JSON.stringify(e))},[e]),m.useEffect(()=>()=>{e.forEach(o=>{o.options?.forEach(a=>{a.imagePreview&&K(a.imagePreview)})})},[e]),{questions:e,setQuestions:t,addQuestion:o=>{const a={id:`question-${Date.now()}`,type:o,text:"",required:!1,...o==="choice"&&{options:[]},...o==="text"&&{placeholderVariable:""}};t(c=>[...c,a])},updateQuestion:(o,a)=>{t(c=>c.map(l=>l.id===o?{...l,...a}:l))},deleteQuestion:o=>{t(a=>a.filter(c=>c.id!==o))}}},oe=()=>{const[e,t]=m.useState(()=>{const a=localStorage.getItem("admin_sections");return a?JSON.parse(a):[]});return m.useEffect(()=>{localStorage.setItem("admin_sections",JSON.stringify(e))},[e]),{sections:e,setSections:t,addSection:()=>{const a={id:`section-${Date.now()}`,title:"New Section",code:"",isMandatory:!1};t(c=>[...c,a])},updateSection:(a,c)=>{t(l=>l.map(u=>u.id===a?{...u,...c}:u))},deleteSection:a=>{t(c=>c.filter(l=>l.id!==a))},reorderSections:a=>{t(a)}}},I=({label:e,error:t,helperText:s,required:r,children:n,fullWidth:o=!1})=>h.jsxs("div",{className:`${o?"w-full":""} space-y-1`,children:[e&&h.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:[e,r&&h.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),h.jsx("div",{className:"mt-1",children:n}),(t||s)&&h.jsx("div",{className:"mt-1",children:t?h.jsx(O.p,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-sm text-red-600",children:t}):s?h.jsx("p",{className:"text-sm text-gray-500",children:s}):null})]}),se=({label:e,error:t,helperText:s,required:r,fullWidth:n,...o})=>h.jsx(I,{label:e,error:t,helperText:s,required:r,fullWidth:n,children:h.jsx("input",{className:`
          block rounded-md shadow-sm
          ${n?"w-full":"w-auto"}
          ${t?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...o})}),re=({label:e,error:t,helperText:s,required:r,fullWidth:n,...o})=>h.jsx(I,{label:e,error:t,helperText:s,required:r,fullWidth:n,children:h.jsx("textarea",{className:`
          block rounded-md shadow-sm
          ${n?"w-full":"w-auto"}
          ${t?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...o})}),ne=({label:e,error:t,helperText:s,required:r,fullWidth:n,children:o,...a})=>h.jsx(I,{label:e,error:t,helperText:s,required:r,fullWidth:n,children:h.jsx("select",{className:`
          block rounded-md shadow-sm
          ${n?"w-full":"w-auto"}
          ${t?"border-red-500 focus:ring-red-500 focus:border-red-500":"border-gray-300 focus:ring-blue-500 focus:border-blue-500"}
          disabled:bg-gray-50 disabled:text-gray-500
        `,...a,children:o})}),ae=({label:e,error:t,helperText:s,required:r,...n})=>h.jsx(I,{error:t,helperText:s,required:r,children:h.jsxs("div",{className:"flex items-center",children:[h.jsx("input",{type:"checkbox",className:`
            rounded border-gray-300 text-blue-600 shadow-sm
            focus:border-blue-300 focus:ring focus:ring-offset-0 focus:ring-blue-200 focus:ring-opacity-50
            ${t?"border-red-500":""}
          `,...n}),e&&h.jsxs("label",{className:"ml-2 block text-sm text-gray-900",children:[e,r&&h.jsx("span",{className:"text-red-500 ml-1",children:"*"})]})]})});export{ae as C,ne as S,se as T,te as a,oe as b,K as c,re as d,W as h,b as m,ee as r,Z as u};
