import{j as e,A as W,m as k}from"./vendor-ui-CMso90iE.js";import{a as n}from"./vendor-react-V1NwqAnN.js";import{m as L,r as V,u as B,a as U,b as P,C as F,T as Q}from"./FormField-Bc5oSVOO.js";import{a as $,u as D,b as H,T as _}from"./index-Cf-NmOnv.js";const Y={hidden:{opacity:0},visible:{opacity:1}},G={hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},J=({isOpen:s,onClose:g,title:p,children:m,footer:l,size:x="md",showCloseButton:f=!0})=>{const u={sm:"max-w-md",md:"max-w-lg",lg:"max-w-2xl",xl:"max-w-4xl"}[x];return e.jsx(W,{mode:"wait",children:s&&e.jsxs(n.Fragment,{children:[e.jsx(k.div,{variants:Y,initial:"hidden",animate:"visible",exit:"hidden",onClick:g,className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-40"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-50 p-4",children:e.jsxs(k.div,{variants:G,initial:"hidden",animate:"visible",exit:"exit",className:`${u} w-full bg-white rounded-lg shadow-xl`,onClick:h=>h.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:p}),f&&e.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-500 focus:outline-none",children:e.jsx("svg",{className:"h-6 w-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"px-6 py-4",children:m}),l&&e.jsx("div",{className:"px-6 py-4 border-t bg-gray-50 rounded-b-lg",children:l})]})})]})})},K=()=>{const{state:s}=$(),{answers:g,sections:p,questions:m}=s,l=n.useMemo(()=>L(i=>i.filter(a=>a.isMandatory)),[]),x=n.useMemo(()=>L((i,a)=>i.find(c=>c.id===a)),[]),f=n.useMemo(()=>L((i,a)=>i.find(c=>c.id===a)),[]),u=n.useCallback((i,a,c)=>{const o=new RegExp(`{{\\s*${a}\\s*}}`,"g");return i.replace(o,c)},[]),h=n.useCallback(i=>{let a="";const c=new Set;return i.forEach(o=>{a+=`// --- Section: ${o.title} (Mandatory) ---
`,a+=o.code+`

`,c.add(o.id)}),{code:a,includedIds:c}},[]),y=n.useCallback((i,a,c,o)=>{let v="";return Object.entries(i).forEach(([r,d])=>{const t=x(a,r);if(!t)return;let b;if(t.type==="choice"&&d?(Array.isArray(d)?d:[d]).forEach(N=>{const S=t.options?.find(C=>C.value===N);S?.linkedSectionId&&(b=S.linkedSectionId)}):(t.type==="text"||t.type==="boolean")&&t.linkedSectionId&&(b=t.linkedSectionId),b&&!o.has(b)){const w=f(c,b);if(w){let N=w.code;t.type==="text"&&t.placeholderVariable&&typeof d=="string"&&(N=u(N,t.placeholderVariable,d)),v+=`// --- Section: ${w.title} (Linked by: ${t.text.substring(0,20)}...) ---
`,v+=N+`

`,o.add(w.id)}}else t.type==="text"&&t.placeholderVariable&&typeof d=="string"&&!b&&(v+=`// User input for "${t.text.substring(0,20)}...": ${d}

`)}),v},[x,f,u]),j=n.useMemo(()=>{const i=l(p),{code:a,includedIds:c}=h(i),o=y(g,m,p,c);return(a+o).trim()||"// No code generated yet. Answer questions or mark sections as mandatory."},[g,p,m,l,h,y]);return e.jsxs("div",{className:"sticky top-4 h-[calc(100vh-2rem)] overflow-hidden rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"bg-gray-100 dark:bg-gray-800 px-4 py-2 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Live Code Preview"})}),e.jsx("pre",{className:"p-4 overflow-auto h-[calc(100%-41px)] bg-white dark:bg-gray-900 text-sm text-gray-800 dark:text-gray-200 font-mono",children:e.jsx("code",{children:j})})]})},X=(s={})=>{const[g,p]=n.useState(!1),m=n.useRef(null),{rootMargin:l="200px",threshold:x=0,triggerOnce:f=!0}=s;return n.useEffect(()=>{if(!m.current||g&&f)return;const u=m.current,h=new IntersectionObserver(y=>{const[j]=y;j.isIntersecting?(p(!0),f&&h.unobserve(u)):f||p(!1)},{rootMargin:l,threshold:x});return h.observe(u),()=>{h.unobserve(u),h.disconnect()}},[l,x,f,g]),{ref:m,isVisible:g}},M=({src:s,alt:g,className:p="",width:m,height:l,placeholderColor:x="#f3f4f6",style:f={},onClick:u,gallerySize:h=!1,sizes:y="100vw",loadingStrategy:j="lazy"})=>{const[i,a]=n.useState(null),[c,o]=n.useState(!1),[v,r]=n.useState(!1),{ref:d,isVisible:t}=X({rootMargin:j==="eager"?"400px":"200px",threshold:0,triggerOnce:!0}),b=s.includes("firebasestorage.googleapis.com");n.useEffect(()=>{if(!t)return;let I=!0,E=null;const R=setTimeout(()=>{I&&!i&&!v&&console.log("Image loading taking longer than expected:",s)},3e3);return(async()=>{try{if(b&&!h){a(s),o(!0);return}if(h)try{const O=await(await fetch(s)).blob(),A=await V(O,400,400);I&&(E=URL.createObjectURL(A),a(E))}catch(T){console.warn(`Failed to resize image, using original: ${s}`,T),I&&a(s)}else a(s)}catch(T){console.error(`Failed to load image: ${s}`,T),I&&(r(!0),b&&(a(s),o(!0)))}})(),()=>{I=!1,clearTimeout(R),E&&URL.revokeObjectURL(E)}},[t,s,h,b]);const w=()=>{o(!0)},N=()=>{r(!0),console.error(`Error loading image: ${s}`)},S=()=>{if(!s.startsWith("data:")&&!s.startsWith("blob:"))return`${s} 1x, ${s} 2x`},C=m&&l?l/m*100:0;return e.jsxs("div",{ref:d,className:`relative overflow-hidden ${p}`,style:{backgroundColor:x,paddingBottom:C?`${C}%`:void 0,...f},onClick:u,children:[i&&e.jsx("img",{src:i,alt:g,className:`transition-opacity duration-300 ${c?"opacity-100":"opacity-0"} absolute inset-0 w-full h-full object-contain`,onLoad:w,onError:N,width:m,height:l,sizes:y,srcSet:S()}),(!i||!c)&&!v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),v&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"text-red-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})})]})},Z=({images:s,onImageClick:g,className:p="",itemClassName:m="",columnCount:l=3,itemGap:x=16,loadingStrategy:f="lazy"})=>{const[u,h]=n.useState(0),[y,j]=n.useState(20),i=n.useRef(null),a=n.useRef(null),c=n.useRef(null),o=n.useCallback(()=>{if(!i.current)return 20;const t=i.current.clientWidth,b=window.innerHeight,N=(t-(l-1)*x)/l;return(Math.ceil(b/(N+x))+2)*l},[l,x]);n.useEffect(()=>{if(c.current)return a.current=new IntersectionObserver(t=>{const[b]=t;if(b.isIntersecting&&y<s.length){const w=o();j(N=>Math.min(N+w,s.length))}},{rootMargin:"200px"}),a.current.observe(c.current),()=>{a.current&&a.current.disconnect()}},[y,s.length,o]),n.useEffect(()=>{const t=()=>{const b=o();j(w=>Math.min(u+b,s.length))};return window.addEventListener("resize",t),t(),()=>{window.removeEventListener("resize",t)}},[u,s.length,o]);const v=s.slice(u,y),r=t=>{g&&g(t)},d=`repeat(${l}, 1fr)`;return e.jsxs("div",{ref:i,className:`w-full ${p}`,children:[e.jsx("div",{className:"grid gap-4",style:{gridTemplateColumns:d,gap:`${x}px`},children:v.map(t=>e.jsxs("div",{className:`cursor-pointer group relative overflow-hidden rounded-lg ${m}`,onClick:()=>r(t),children:[e.jsx(M,{src:t.src,alt:t.alt||"Gallery image",className:"w-full h-full transition-transform duration-300",style:{transform:`scale(${t.scale||1})`,transformOrigin:"center center"},gallerySize:!0,loadingStrategy:f,sizes:"(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 33vw"}),e.jsx("div",{className:"absolute inset-0 bg-black opacity-0 group-hover:opacity-20 transition-opacity"}),t.displayText&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 bg-black bg-opacity-50 text-white",children:e.jsx("p",{className:"text-sm truncate",children:t.displayText})})]},t.id))}),y<s.length&&e.jsx("div",{ref:c,className:"w-full h-20 flex items-center justify-center mt-4",children:e.jsx("div",{className:"w-8 h-8 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"})}),y>=s.length&&s.length>0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-4",children:"All images loaded"}),s.length===0&&e.jsx("div",{className:"w-full text-center text-gray-500 mt-4 py-8",children:"No images available"})]})},q={initial:{opacity:0,y:20},animate:{opacity:1,y:0,transition:{staggerChildren:.1}}},z={initial:{opacity:0,y:10},animate:{opacity:1,y:0}},ne=()=>{const{getBannerImage:s,getScannerImages:g}=B();D();const{theme:p}=H(),{state:m,dispatch:l}=$(),{questions:x}=U(),{sections:f}=P(),[u,h]=n.useState(null),[y,j]=n.useState("");n.useEffect(()=>{l({type:"SET_QUESTIONS",payload:x})},[x,l]),n.useEffect(()=>{l({type:"SET_SECTIONS",payload:f})},[f,l]);const i=s(),[a,c]=n.useState([]);n.useEffect(()=>{try{const r=g();c(r),console.log("Scanner Images loaded:",r.length)}catch(r){console.error("Error loading scanner images:",r),c([])}},[g]);const o=(r,d)=>{l({type:"SET_ANSWER",payload:{questionId:r,value:d}})},v=r=>{const d=m.answers[r.id];switch(r.type){case"text":return e.jsx(Q,{label:r.text,value:d||"",onChange:t=>o(r.id,t.target.value),required:r.required,className:"text-gray-900 dark:text-white bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600"});case"choice":return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:[r.text," ",r.required&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:r.options?.map(t=>e.jsxs("label",{className:`
                    flex flex-col items-center p-4 border rounded-lg cursor-pointer
                    transition-all duration-150 ease-in-out
                    ${d===t.value?"border-blue-500 bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"}
                  `,children:[e.jsx("input",{type:"radio",name:r.id,value:t.value,checked:d===t.value,onChange:()=>o(r.id,t.value),className:"sr-only"}),t.imageUrl&&e.jsx("img",{src:t.imagePreview||t.imageUrl,alt:t.text,className:"w-full h-32 object-contain mb-2 rounded",style:{transform:`scale(${t.scale||1})`}}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white text-center",children:t.text})]},t.id))})]});case"boolean":return e.jsx(F,{label:r.text,checked:!!d,onChange:t=>o(r.id,t.target.checked),required:r.required});default:return null}};return e.jsx("div",{className:p==="dark"?"dark":"",children:e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 transition-colors duration-200",children:[e.jsx(_,{}),e.jsxs(k.div,{variants:q,initial:"initial",animate:"animate",className:"relative",children:[e.jsx(k.div,{variants:z,className:"py-12 px-4 text-center",children:e.jsx("h1",{className:"text-5xl md:text-6xl lg:text-7xl font-bold text-gray-900 dark:text-white font-display tracking-tight",children:"COMET Scanner Template Wizard"})}),e.jsx(k.div,{variants:z,className:"relative w-full mb-12 bg-gray-100 dark:bg-gray-800",children:i?e.jsx("div",{className:"relative w-full flex items-center justify-center overflow-hidden",children:e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx(M,{src:i.src,alt:"COMET Scanner Banner",className:"absolute top-0 left-0 w-full h-full object-contain transition-transform duration-300",style:{transform:`scale(${i.scale||1})`,transformOrigin:"center center"},loadingStrategy:"eager"})})}):e.jsx("div",{className:"w-full",style:{paddingBottom:"42.85%"},children:e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600 to-purple-600 flex items-center justify-center",children:e.jsx("span",{className:"text-3xl text-white font-semibold",children:"Visualize Your Data with COMET Scanner"})})})}),a.length>0&&e.jsxs(k.div,{variants:z,className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-16",children:[e.jsx("h2",{className:"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-8 text-center",children:"Scanner Variations"}),e.jsx(Z,{images:a,onImageClick:r=>{h(r.src),j(r.displayText||"Scanner Variation")},columnCount:3,itemGap:16,className:"mb-8",itemClassName:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden transform transition-transform hover:scale-105",loadingStrategy:"lazy"})]}),e.jsxs("div",{className:"max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-16 grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-2 space-y-8",children:e.jsxs(k.div,{variants:z,children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-6",children:"Configure Your Template"}),e.jsxs("div",{className:"space-y-6",children:[m.questions.map(r=>e.jsx("div",{className:"p-6 bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700",children:v(r)},r.id)),m.questions.length===0&&e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No questions configured yet. Please set them up in the Admin Dashboard."})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(K,{})})]})]}),u&&e.jsx(J,{isOpen:!0,onClose:()=>{h(null),j("")},title:y,size:"xl",children:e.jsx("div",{className:"relative",children:e.jsx("div",{className:"flex justify-center items-center bg-white dark:bg-gray-800 rounded-lg p-4",children:e.jsx(M,{src:u,alt:y,className:"max-w-full max-h-[80vh] object-contain",loadingStrategy:"eager"})})})})]})})};export{ne as default};
